# 1. Name of your application
service: personal-website

# 2. Your Docker Hub Image
image: sirjimmylin/personal-website  # <--- REPLACE 'jimmylin' with your Docker Hub user


proxy:
  ssl: true
  hosts:
    - sirjimmylin.com
    - www.sirjimmylin.com
  app_port: 3000

# 3. Server Configuration
servers:
  web:
    hosts:
      - 104.236.93.159 # <--- REPLACE with your Droplet IP
    

# 4. Registry Credentials (Docker Hub)
registry:
  server: index.docker.io
  username: sirjimmylin  # <--- REPLACE with your Docker Hub user
  password:
    - KAMAL_REGISTRY_PASSWORD

# 5. Builder Configuration (THIS WAS THE ISSUE)
# This sits at the 'root' level, fully to the left (no spaces before 'builder')
builder:
  arch: amd64

# 6. Environment Variables
env:
  secret:
    - RAILS_MASTER_KEY
  clear:
    # This must match your Droplet IP so the app can find the DB
    DB_HOST: 104.236.93.159 # <--- REPLACE with your Droplet IP
    POSTGRES_USER: personal_website
    POSTGRES_DB: personal_website_production
    POSTGRES_PASSWORD: B*LCdz!&8RU&%q # <--- CHANGE THIS to something secure

# 7. Accessories (The Database)
# This also sits at the 'root' level
accessories:
  db:
    image: postgres:15
    host: 104.236.93.159 # <--- REPLACE with your Droplet IP
    port: 5432
    env:
      clear:
        POSTGRES_USER: personal_website
        POSTGRES_DB: personal_website_production
        POSTGRES_PASSWORD: B*LCdz!&8RU&%q # <--- MUST MATCH the password above
    directories:
      - data:/var/lib/postgresql/data

